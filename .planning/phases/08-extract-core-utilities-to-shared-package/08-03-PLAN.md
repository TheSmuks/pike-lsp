---
phase: 08-extract-core-utilities-to-shared-package
plan: 03
type: execute
wave: 3
depends_on: ["08-02"]
files_modified: [
  packages/pike-lsp-server/package.json,
  packages/pike-lsp-server/src/server.ts,
  packages/pike-lsp-server/src/core/index.ts,
  packages/pike-lsp-server/src/core/errors.ts,
  packages/pike-lsp-server/src/core/logging.ts
]
autonomous: true

must_haves:
  truths:
    - "pike-lsp-server imports Logger and Errors from @pike-lsp/core"
    - "Local duplicate files removed from pike-lsp-server/src/core/"
    - "LSP server feature tests pass using extracted utilities"
  artifacts:
    - path: "packages/pike-lsp-server/package.json"
      provides: "Workspace dependency on @pike-lsp/core"
  key_links:
    - from: "packages/pike-lsp-server/src/features/navigation.ts"
      to: "@pike-lsp/core"
      via: "import { Logger } from '@pike-lsp/core'"
---

<objective>
Migrate @pike-lsp/pike-lsp-server to use the shared core package and remove duplicate code.

Purpose: Finalize extraction and achieve single source of truth across the entire project.
Output: Refactored LSP server using shared utilities.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/ROADMAP.md
@.planning/phases/08-extract-core-utilities-to-shared-package/08-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add workspace dependency</name>
  <files>packages/pike-lsp-server/package.json</files>
  <action>
    Add "@pike-lsp/core": "workspace:*" to dependencies in packages/pike-lsp-server/package.json.
    Run pnpm install from root.
  </action>
  <verify>grep "@pike-lsp/core" packages/pike-lsp-server/package.json</verify>
  <done>Server package can now resolve core utilities.</done>
</task>

<task type="auto">
  <name>Task 2: Update imports in server package</name>
  <files>packages/pike-lsp-server/src/core/index.ts, packages/pike-lsp-server/src/features/*.ts, packages/pike-lsp-server/src/services/*.ts</files>
  <action>
    Update src/core/index.ts to re-export from '@pike-lsp/core'.
    Update all feature and service files to import from '@pike-lsp/core' (or through core/index.ts if appropriate).
    Preferred: Import fundamental types like Logger directly from '@pike-lsp/core'.
  </action>
  <verify>grep "@pike-lsp/core" packages/pike-lsp-server/src/services/bridge-manager.ts</verify>
  <done>Server modules refactored to use shared utilities.</done>
</task>

<task type="auto">
  <name>Task 3: Remove duplicate files and verify</name>
  <files>packages/pike-lsp-server/src/core/errors.ts, packages/pike-lsp-server/src/core/logging.ts</files>
  <action>
    Delete packages/pike-lsp-server/src/core/errors.ts and packages/pike-lsp-server/src/core/logging.ts.
    Run full build and E2E feature tests.
  </action>
  <verify>pnpm --filter pike-lsp-server run test:features</verify>
  <done>Extraction complete and verified end-to-end.</done>
</task>

</tasks>

<verification>
Check for any remaining local references to logging.ts/errors.ts in the server package.
Verify logs appear in extension output as before.
</verification>

<success_criteria>
~400 lines of duplicate code removed from the repository.
Project architecture reflects leaf-package utility sharing.
</success_criteria>

<output>
After completion, create `.planning/phases/08-extract-core-utilities-to-shared-package/08-03-SUMMARY.md`
</output>
